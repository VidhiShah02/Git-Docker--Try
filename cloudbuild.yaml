substitutions:
  _CLOUDSDK_COMPUTE_REGION :  us-central1-c  # default value
  _CLOUDSDK_COMPUTE_ZONE: us-central1-c    # default value
  _CLOUDSDK_CONTAINER_CLUSTER: cluster1   # default value
steps:
- name: 'gcr.io/cloud-builders/docker'
  args: ['build','-t','gcr.io/$PROJECT_ID/$_PROJECT:$SHORT_SHA','.']

- name: 'gcr.io/cloud-builders/docker'
  args: ['push','gcr.io/$PROJECT_ID/$_PROJECT:$SHORT_SHA']

#- name: 'gcr.io/cloud-builders/gcloud'
#  args: ['config','set','project','${_PROJECT}']

- name: 'gcr.io/cloud-builders/kubectl'
  args: ['apply','-f','python-service','--image','gcr.io/$PROJECT_ID/$_PROJECT:$SHORT_SHA','--region','us-central1','--platform','managed','--memory','8Gi','--cpu','8']
  env:
  - 'CLOUDSDK_COMPUTE_REGION=${_CLOUDSDK_COMPUTE_REGION}'
  - 'CLOUDSDK_CONTAINER_CLUSTER=${_CLOUDSDK_CONTAINER_CLUSTER}'
  - 'CLOUDSDK_COMPUTE_ZONE=${_CLOUDSDK_COMPUTE_ZONE}'

images: ['gcr.io/$PROJECT_ID/$_PROJECT:$SHORT_SHA']
#options:
  #logging: CLOUD_LOGGING_ONLY

